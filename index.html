<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sugarbush Signal | Precision Sugaring Intelligence</title>
  <script>
(function() {
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const isNarrow = window.innerWidth <= 800;
const isAppMode = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

if (isMobile || isNarrow || isAppMode) {
if (!window.location.pathname.includes('mobile.html')) {
window.location.href = 'mobile.html';
}
}
})();
</script>
  <style>
:root { 
--primary:#5d4037; 
--accent:#8d6e63; 
--bg:#fcf8f2; 
--card:#ffffff; 
--text:#3e2723;
--error:#d32f2f;
--success:#388e3c;
}

body {
box-sizing: border-box;
font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
background:var(--bg);
color:var(--text);
padding:40px 20px;
max-width:1000px;
margin:0 auto;
line-height:1.6;
}

.card {
background:var(--card);
padding:40px;
border-radius:16px;
box-shadow:0 10px 30px rgba(62,39,35,0.1);
border-top:10px solid var(--primary);
}

header { 
text-align:center; 
margin-bottom:30px; 
}

h1 {
font-size:2.5rem;
color:var(--primary);
margin:0;
letter-spacing:-1px;
}

.subtitle {
font-weight:800;
font-size:0.9rem;
color:var(--accent);
text-transform:uppercase;
letter-spacing:2px;
margin-top:8px;
}

.trivia-box {
background:#efebe9;
border-left:5px solid var(--accent);
padding:20px;
margin-bottom:30px;
font-style:italic;
border-radius:4px;
color:#4e342e;
}

.input-wrapper {
margin-bottom:40px;
}

.input-area {
display:flex;
gap:15px;
justify-content:center;
align-items:flex-start;
flex-wrap:wrap;
}

.input-group {
display:flex;
flex-direction:column;
gap:8px;
flex:1;
min-width:250px;
max-width:350px;
}

label {
font-size:0.85rem;
font-weight:700;
color:var(--primary);
text-transform:uppercase;
letter-spacing:0.5px;
}

input {
padding:15px;
border:2px solid #d7ccc8;
border-radius:10px;
width:100%;
font-size:1.1rem;
outline:none;
transition:border-color 0.2s;
}

input:focus {
border-color:var(--primary);
}

input.error {
border-color:var(--error);
}

button {
padding:15px 40px;
background:var(--primary);
color:white;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
transition:all 0.2s;
font-size:1.1rem;
align-self:flex-end;
}

button:hover {
background:#4e342e;
transform:translateY(-1px);
box-shadow:0 4px 12px rgba(93,64,55,0.3);
}

button:active { 
transform:scale(0.98); 
}

button:disabled {
background:#d7ccc8;
cursor:not-allowed;
transform:none;
}

#errorMessage {
display:none;
background:#ffebee;
color:var(--error);
padding:15px 20px;
border-radius:8px;
margin-top:15px;
border-left:4px solid var(--error);
font-weight:600;
text-align:center;
}

#gddWrapper {
margin-bottom:30px;
display:none;
background:#fafafa;
padding:20px;
border-radius:12px;
border:1px solid #efebe9;
}

.gdd-container {
background:#e0e0e0;
border-radius:20px;
height:24px;
position:relative;
overflow:hidden;
margin:10px 0;
}

.gdd-bar {
background:linear-gradient(90deg,#81c784,#fff176,#e57373);
height:100%;
width:0%;
transition:width 2s ease-in-out;
}

.gdd-label {
position:absolute;
width:100%;
text-align:center;
font-size:12px;
font-weight:bold;
line-height:24px;
color:#333;
z-index:1;
}

.grid {
display:none;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-bottom:40px;
}

.stat {
background:#fff;
padding:25px;
border-radius:12px;
text-align:center;
border:1px solid #d7ccc8;
box-shadow:0 2px 5px rgba(0,0,0,0.02);
transition:transform 0.2s;
}

.stat:hover {
transform:translateY(-2px);
box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.stat label {
display:block;
font-size:11px;
font-weight:900;
color:var(--accent);
text-transform:uppercase;
margin-bottom:10px;
letter-spacing:1px;
}

.stat span {
font-size:28px;
font-weight:900;
color:var(--primary);
}

.stat-highlight {
border:2px solid var(--primary);
background:#fff9f5;
}

table {
width:100%;
border-collapse:collapse;
display:none;
background:white;
border-radius:12px;
overflow:hidden;
box-shadow:0 4px 15px rgba(0,0,0,0.05);
}

th {
background:#f5f5f5;
padding:15px;
font-size:12px;
text-transform:uppercase;
color:var(--accent);
font-weight:900;
letter-spacing:0.5px;
}

td {
padding:15px;
text-align:center;
border-bottom:1px solid #efebe9;
}

tr:last-child td {
border-bottom:none;
}

tr:hover {
background:#fafafa;
}

.badge {
padding:6px 12px;
border-radius:6px;
font-weight:bold;
font-size:11px;
display:inline-block;
}

.run { 
background:#e8f5e9; 
color:#2e7d32; 
}

.risk { 
background:#ffebee; 
color:#c62828; 
}

.loader {
text-align:center;
display:none;
font-weight:bold;
color:var(--primary);
padding:20px;
font-size:1.1rem;
}

.loader::after {
content:'';
display:inline-block;
width:20px;
height:20px;
border:3px solid var(--accent);
border-top-color:transparent;
border-radius:50%;
animation:spin 0.8s linear infinite;
margin-left:10px;
vertical-align:middle;
}

@keyframes spin {
to { transform:rotate(360deg); }
}

@media (max-width: 600px) {
body {
padding:20px 15px;
}

.card {
padding:20px;
}

h1 {
font-size:1.8rem;
}

.input-area {
flex-direction:column;
}

button {
width:100%;
}
}
</style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="card">
   <header>
    <h1>üçÅ Sugarbush Signal</h1>
    <div class="subtitle">
     Precision Boiling &amp; Seasonal Intelligence
    </div>
   </header>
   <div id="trivia" class="trivia-box" role="complementary" aria-label="Sugaring trivia">
    Stoking the evaporator...
   </div>
   <div class="input-wrapper">
    <div class="input-area">
     <div class="input-group"><label for="zipInput">ZIP Code</label> <input type="text" id="zipInput" placeholder="Enter 5-digit ZIP" maxlength="5" aria-required="true" aria-describedby="errorMessage">
     </div><button onclick="runAnalysis()" id="analyzeBtn"> üå°Ô∏è Check Conditions </button>
    </div>
    <div id="errorMessage" role="alert" aria-live="polite"></div>
   </div>
   <div id="loader" class="loader" role="status" aria-live="polite">
    Syncing with Weather Grid
   </div>
   <div id="gddWrapper"><label style="font-size:12px;font-weight:800;color:var(--primary);"> üìä SEASON VITALITY (CUMULATIVE GDD BASE 40¬∞F) </label>
    <div class="gdd-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="150">
     <div id="gddBar" class="gdd-bar"></div>
     <div id="gddLabel" class="gdd-label">
      0 GDD Accumulated
     </div>
    </div>
    <div id="seasonAdvice" style="font-size:14px;margin-top:10px;font-weight:500;"></div>
   </div>
   <main>
    <div id="dashboard" class="grid">
     <div class="stat"><label>Grid Elevation</label> <span id="val-elev">--</span>
     </div>
     <div class="stat"><label>Water Boiling Point</label> <span id="val-water">--</span>
     </div>
     <div class="stat stat-highlight"><label>üéØ Finish Syrup At</label> <span id="val-syrup">--</span>
     </div>
    </div>
    <table id="forecastTable">
     <thead>
      <tr>
       <th>Day</th>
       <th>High / Low</th>
       <th>Sap Flow Potential</th>
       <th>Safety Warning</th>
      </tr>
     </thead>
     <tbody id="forecastBody"></tbody>
    </table>
   </main>
  </div>
  <script>
const facts=[
"It takes roughly 40 gallons of sap to produce 1 gallon of syrup.",
"A night below freezing followed by a day above 40¬∞F is the ideal sap run weather.",
"Maple sap is typically 2% sugar; syrup must be 66% sugar.",
"The sugar in maple sap is created by the tree the previous summer during photosynthesis.",
"Once buds begin to swell, the sap chemistry changes, creating a 'buddy' off-flavor.",
"The boiling point of water drops about 1¬∞F for every 500 feet of elevation gain.",
"Sugar maples can produce sap for over 100 years when properly tapped.",
"The Indigenous peoples of North America were the first to discover maple sugaring.",
"Maple syrup season typically lasts 4-6 weeks in late winter and early spring.",
"Vermont produces nearly 50% of all maple syrup in the United States."
];

window.onload=()=>{
document.getElementById('trivia').innerText=
"üçÅ Sugarbush Trivia: "+facts[Math.floor(Math.random()*facts.length)];

// Allow Enter key to trigger analysis
document.getElementById('zipInput').addEventListener('keypress', (e) => {
if (e.key === 'Enter') {
runAnalysis();
}
});
};

async function runAnalysis(){
const zipInput = document.getElementById('zipInput');
const zip = zipInput.value.trim();
const loader = document.getElementById('loader');
const btn = document.getElementById('analyzeBtn');
const errorMsg = document.getElementById('errorMessage');

// Clear previous error state
zipInput.classList.remove('error');
errorMsg.style.display = 'none';

// Validate ZIP
if(!/^\d{5}$/.test(zip)) {
showError("Please enter a valid 5-digit ZIP code.");
zipInput.classList.add('error');
zipInput.focus();
return;
}

// Show loading state
loader.style.display='block';
btn.disabled = true;
btn.innerText = 'üîÑ Checking...';

// Hide previous results
document.getElementById('gddWrapper').style.display='none';
document.getElementById('dashboard').style.display='none';
document.getElementById('forecastTable').style.display='none';

try{
// Fetch location data
const zipRes = await fetch(`https://api.zippopotam.us/us/${zip}`);
if (!zipRes.ok) throw new Error('ZIP code not found');
const zipData = await zipRes.json();
const lat = zipData.places[0].latitude;
const lon = zipData.places[0].longitude;

// Fetch weather.gov points
const pointsRes = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
if (!pointsRes.ok) throw new Error('Weather data unavailable for this location');
const pointsData = await pointsRes.json();

// Fetch grid data for elevation
const gridRes = await fetch(pointsData.properties.forecastGridData);
if (!gridRes.ok) throw new Error('Grid data unavailable');
const gridData = await gridRes.json();
const elevFt = gridData.properties.elevation.value * 3.28084;

// Fetch forecast
const forecastRes = await fetch(pointsData.properties.forecast);
if (!forecastRes.ok) throw new Error('Forecast unavailable');
const forecastData = await forecastRes.json();

// Calculate boiling points based on elevation
const waterBoil = 212 - (elevFt / 500);
const syrupBoil = waterBoil + 7;

// Display dashboard stats
document.getElementById('val-elev').innerText = Math.round(elevFt).toLocaleString() + " ft";
document.getElementById('val-water').innerText = waterBoil.toFixed(1) + "¬∞F";
document.getElementById('val-syrup').innerText = syrupBoil.toFixed(1) + "¬∞F";
document.getElementById('dashboard').style.display = 'grid';

// Build forecast table
const tbody = document.getElementById('forecastBody');
tbody.innerHTML = '';

const periods = forecastData.properties.periods.slice(0, 14);
for (let i = 0; i < periods.length - 1; i += 2) {
const day = periods[i];
const night = periods[i + 1];
  
const row = document.createElement('tr');
  
// Day name
const dayCell = document.createElement('td');
dayCell.innerHTML = `<strong>${day.name}</strong>`;
row.appendChild(dayCell);
  
// Temperature range
const tempCell = document.createElement('td');
const high = day.temperature;
const low = night.temperature;
tempCell.innerHTML = `<strong>${high}¬∞F</strong> / ${low}¬∞F`;
row.appendChild(tempCell);
  
// Sap flow potential
const sapCell = document.createElement('td');
let sapStatus = '';
let sapBadge = '';
  
if (high >= 38 && high <= 50 && low < 32) {
sapStatus = '‚≠ê Excellent Run';
sapBadge = 'run';
} else if (high >= 35 && high <= 55 && low < 35) {
sapStatus = '‚úì Good Run';
sapBadge = 'run';
} else if (high > 55) {
sapStatus = 'üå°Ô∏è Too Warm';
sapBadge = 'risk';
} else if (low > 32) {
sapStatus = 'üî• No Freeze';
sapBadge = 'risk';
} else {
sapStatus = '‚ùÑÔ∏è Too Cold';
sapBadge = 'risk';
}
  
sapCell.innerHTML = `<span class="badge ${sapBadge}">${sapStatus}</span>`;
row.appendChild(sapCell);
  
// Safety warnings
const warnCell = document.createElement('td');
let warning = '‚úì Safe';
  
const forecast = (day.shortForecast + ' ' + night.shortForecast).toLowerCase();
if (forecast.includes('storm') || forecast.includes('severe') || forecast.includes('thunder')) {
warning = '‚ö†Ô∏è Storm Risk';
} else if (forecast.includes('ice') || forecast.includes('freezing rain')) {
warning = 'üßä Icing Hazard';
} else if (day.windSpeed && parseInt(day.windSpeed) > 25) {
warning = 'üí® High Winds';
} else if (forecast.includes('snow')) {
warning = '‚ùÑÔ∏è Snow Expected';
}
  
warnCell.innerText = warning;
row.appendChild(warnCell);
  
tbody.appendChild(row);
}

document.getElementById('forecastTable').style.display = 'table';

// GDD Calculation
try {
const now = new Date();
const start = new Date(now.getFullYear(), 0, 1);
const diffDays = Math.ceil((now - start) / (1000 * 60 * 60 * 24));
const gddUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min&past_days=${diffDays}&timezone=auto&temperature_unit=fahrenheit`;
const gddRes = await fetch(gddUrl);
if (!gddRes.ok) throw new Error('GDD data unavailable');
const gddData = await gddRes.json();

let totalGDD = 0;
for (let i = 0; i < gddData.daily.time.length; i++) {
const h = gddData.daily.temperature_2m_max[i];
const l = gddData.daily.temperature_2m_min[i];
if (h !== null && l !== null) {
totalGDD += Math.max(((h + l) / 2) - 40, 0);
}
}

document.getElementById('gddWrapper').style.display = 'block';
const percent = Math.min((totalGDD / 150) * 100, 100);
setTimeout(() => {
document.getElementById('gddBar').style.width = percent + "%";
}, 100);
document.getElementById('gddLabel').innerText = Math.round(totalGDD) + " GDD Units";

const progressBar = document.querySelector('.gdd-container');
progressBar.setAttribute('aria-valuenow', Math.round(totalGDD));

let advice = "üå≥ Buds are dormant. Sap quality is prime ‚Äî optimal sugaring conditions!";
if (totalGDD > 75) advice = "üü° Trees are waking up. Monitor bud swell closely for quality changes.";
if (totalGDD > 125) advice = "üö® ALERT: Buds swelling rapidly. Season end is imminent ‚Äî buddy sap likely!";
document.getElementById('seasonAdvice').innerText = advice;
} catch (e) {
document.getElementById('gddWrapper').style.display = 'block';
document.getElementById('seasonAdvice').innerText = '‚ö†Ô∏è GDD tracking temporarily unavailable. Core forecast data is still accurate.';
console.warn('GDD calculation error:', e);
}

loader.style.display = 'none';
btn.disabled = false;
btn.innerText = 'üå°Ô∏è Check Conditions';

} catch(err) {
loader.style.display = 'none';
btn.disabled = false;
btn.innerText = 'üå°Ô∏è Check Conditions';
console.error('Analysis error:', err);
showError('Unable to fetch weather data. Please verify the ZIP code is valid and try again.');
zipInput.classList.add('error');
}
}

function showError(message) {
const errorDiv = document.getElementById('errorMessage');
errorDiv.innerText = '‚ö†Ô∏è ' + message;
errorDiv.style.display = 'block';

// Auto-hide after 6 seconds
setTimeout(() => {
errorDiv.style.display = 'none';
}, 6000);
}
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bade62d91f3e0b5',t:'MTc2Nzg5ODQyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
